<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Daily Income App</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f2f2f2;
    }
    .header {
      background: #ff9800;
      color: white;
      padding: 20px;
      text-align: center;
      font-size: 18px;
    }
    .wallet-box {
      display: flex;
      justify-content: space-around;
      padding: 10px;
      background: #fff;
      border-bottom: 1px solid #ddd;
    }
    .wallet-box div {
      text-align: center;
    }
    .wallet-box div span {
      display: block;
      font-weight: bold;
    }
    .vip-banner {
      background: linear-gradient(90deg, #ff9800, #ff5722);
      color: white;
      padding: 10px;
      text-align: center;
      font-weight: bold;
    }
    .quick-actions {
      display: flex;
      justify-content: space-around;
      background: #fff;
      padding: 15px 0;
      border-bottom: 1px solid #ddd;
    }
    .quick-actions a {
      text-align: center;
      text-decoration: none;
      color: #333;
      font-size: 14px;
    }
    .quick-actions a div {
      font-size: 20px;
    }
    .tabs {
      display: flex;
      justify-content: center;
      margin: 10px 0;
    }
    .tabs button {
      background: #fff;
      border: 1px solid #ff9800;
      color: #ff9800;
      padding: 5px 10px;
      margin: 0 5px;
      border-radius: 20px;
      cursor: pointer;
    }
    .plan-card {
      background: #fff;
      margin: 10px;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .plan-card h3 {
      margin: 0;
      font-size: 16px;
    }
    .plan-details {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      font-size: 14px;
    }
    .buy-btn {
      background: #ff9800;
      color: white;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
      text-decoration: none;
      display: block;
      font-weight: bold;
    }
    .bottom-nav {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #fff;
      border-top: 1px solid #ccc;
      display: flex;
      justify-content: space-around;
      padding: 8px 0;
    }
    .bottom-nav a {
      color: #333;
      text-decoration: none;
      text-align: center;
      font-size: 13px;
    }
    .bottom-nav a.active {
      color: #ff9800;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div class="header">Welcome to Income App</div>

  <div class="wallet-box">
    <div><span>‚Çπ0</span>Recharge</div>
    <div><span>‚Çπ0</span>Total Income</div>
    <div><span>‚Çπ0</span>Balance</div>
  </div>

  <div class="vip-banner">VIP 1 Activated - Get More Benefits</div>

  <div class="quick-actions">
    <a href="recharge.html">
      <div>üí∞</div>Recharge
    </a>
    <a href="withdraw.html">
      <div>üèß</div>Withdraw
    </a>
    <a href="invite.html">
      <div>üì§</div>Share
    </a>
    <a href="online.html">
      <div>üßë‚Äçüíª</div>Online
    </a>
  </div>

  <div class="tabs">
    <button>Daily Income</button>
    <button>Benefits Program</button>
  </div>

  <!-- Sample Product Card -->
  <div class="plan-card">
    <h3>Plan ‚Çπ1000</h3>
    <div class="plan-details">
      <div>Daily: ‚Çπ100</div>
      <div>Days: 10</div>
      <div>Total: ‚Çπ1000</div>
    </div>
    <a href="investment.html" class="buy-btn">Buy Now</a>
  </div>

  <!-- Repeat more cards if needed -->

<div class="bottom-nav">
     <a href="index.html"><div>üè†<br/>Home</div></a>
    <a href="team.html"><div>üë•<br/>Team</div></a>
    <a href="investment.html"><div>üç™<br/>Devices</div></a>
    <a href="my.html"><div>üë§<br/>My</div></a>
  </div>
<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
   const firebaseConfig = {
            apiKey: "AIzaSyD7mrPd_JFePxDLA4YifSaYfCsZHCZ7V-E",
            authDomain: "grow-3e3a1.firebaseapp.com",
            databaseURL: "https://grow-3e3a1-default-rtdb.firebaseio.com",
            projectId: "grow-3e3a1",
           
        };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  let currentUser = null;

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      loadAll(user.uid);
    } else {
      alert("Please login first");
      location.href = "login.html";
    }
  });

  function loadAll(uid) {
    const userRef = db.ref("users/" + uid);
    userRef.on("value", snap => {
      const d = snap.val();
      document.getElementById("username").innerText = d.name || "User";
      document.getElementById("recharge").innerText = d.wallet.recharge || 0;
      document.getElementById("bonus").innerText = d.wallet.bonus || 0;
      document.getElementById("winning").innerText = d.wallet.winning || 0;
      document.getElementById("totalRecharge").innerText = d.wallet.recharge || 0;
      document.getElementById("refCode").innerText = d.referralCode || "None";
      document.getElementById("vipLevel").innerText = "VIP-" + (d.vipLevel || 0);
      const total = (d.wallet.recharge || 0) + (d.wallet.bonus || 0) + (d.wallet.winning || 0);
      document.getElementById("total").innerText = total;
    });

    db.ref("plans").on("value", snap => {
      const planList = document.getElementById("planList");
      planList.innerHTML = "<h3>üì¶ Available Investment Plans</h3>";
      snap.forEach(p => {
        const d = p.val();
        const key = p.key;
        planList.innerHTML += `
        <div class="plan-card">
          <img src="${d.image || 'https://via.placeholder.com/300'}" />
          <h4>${d.title}</h4>
          <p>Price: ‚Çπ${d.price}</p>
          <p>Daily: ‚Çπ${d.daily} x ${d.days} days</p>
          <button class="btn-buy" onclick="buyPlan('${key}', ${d.price}, ${d.daily}, ${d.days})">Buy Now</button>
        </div>`;
      });
    });

    db.ref("purchases/" + uid).on("value", snap => {
      const list = document.getElementById("purchaseList");
      list.innerHTML = "<h3>üõí My Active Plans</h3>";
      snap.forEach(p => {
        const d = p.val();
        list.innerHTML += `
        <div class="purchase-card">
          <p>Daily Income: ‚Çπ${d.daily}</p>
          <p>Days Left: ${d.days_left}</p>
          <p>Start: ${d.start_date}</p>
        </div>`;
      });
    });

    db.ref("users/" + uid + "/referredUsers").on("value", s => {
      document.getElementById("referred").innerText = s.numChildren();
    });

    db.ref("daily_income_logs/" + uid).on("value", s => {
      document.getElementById("refIncome").innerText = s.numChildren() * 10; // adjust as needed
    });

    db.ref("wallet_logs/" + uid).limitToLast(10).on("value", s => {
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      s.forEach(l => {
        const d = l.val();
        list.innerHTML += <li>${d.type} ‚Äì ‚Çπ${d.amount} ‚Äì ${d.status}</li>;
      });
    });

    db.ref("notice").on("value", s => {
      document.getElementById("notice").innerText = "üì¢ " + (s.val() || "Welcome!");
    });
  }

  function buyPlan(id, price, daily, days) {
    const uid = currentUser.uid;
    db.ref("users/" + uid + "/wallet").once("value").then(snap => {
      let w = snap.val();
      let total = (w.recharge || 0) + (w.bonus || 0) + (w.winning || 0);
      if (total < price) return alert("Insufficient balance!");

      // Deduct from recharge -> bonus -> winning
      let remaining = price;
      let r = w.recharge, b = w.bonus, win = w.winning;
      if (r >= remaining) r -= remaining, remaining = 0;
      else remaining -= r, r = 0;
      if (remaining && b >= remaining) b -= remaining, remaining = 0;
      else remaining -= b, b = 0;
      if (remaining && win >= remaining) win -= remaining, remaining = 0;

      db.ref("users/" + uid + "/wallet").set({ recharge: r, bonus: b, winning: win });

      db.ref("purchases/" + uid + "/" + id).set({
        daily: daily,
        days_left: days,
        start_date: new Date().toISOString().split("T")[0]
      });

      alert("Plan purchased!");
    });
  }

  function copyCode() {
    const text = document.getElementById("refCode").innerText;
    navigator.clipboard.writeText(text);
    alert("Referral code copied!");
  }
</script>

</body>
</html>
