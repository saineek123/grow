  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD7mrPd_JFePxDLA4YifSaYfCsZHCZ7V-E",
      authDomain: "grow-3e3a1.firebaseapp.com",
      databaseURL: "https://grow-3e3a1-default-rtdb.firebaseio.com",
      projectId: "grow-3e3a1"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    function registerUser() {
      const phone = document.getElementById("phone").value.trim();
      const name = document.getElementById("name").value.trim();
      const password = document.getElementById("password").value.trim();
      const confirmPassword = document.getElementById("confirmPassword").value.trim();
      const referralCode = document.getElementById("referralCode").value.trim();
      const successAnimation = document.getElementById("successAnimation");

      if (!phone || !name || !password || !confirmPassword) {
        alert("❌ सभी जानकारी भरें");
        return;
      }
      if (password !== confirmPassword) {
        alert("❌ पासवर्ड मैच नहीं कर रहा");
        return;
      }

      const fakeEmail = phone + "@example.com";

      auth.createUserWithEmailAndPassword(fakeEmail, password)
        .then((userCredential) => {
          const user = userCredential.user;
          const newUserData = {
            name: name,
            phone: phone,
            email: fakeEmail,
            referralCode: user.uid,
            referredBy: referralCode,
            createdAt: Date.now(),
            wallet: { recharge: 0, bonus: 0, winning: 0, total: 0 }
          };

          db.ref("users/" + user.uid).set(newUserData)
          .then(() => {
            if (referralCode !== "") {
              const bonusAmount = 50;
              const memberData = {
                name: name,
                joinedAt: Date.now(),
                earnings: 0,
                status: "active"
              };

              // 1. User ke node me save
              db.ref("users/" + referralCode + "/referrals/" + user.uid).set(true);

              // 2. Global referrals list me save
              db.ref("referrals/" + referralCode + "/" + user.uid).set(memberData);

              // 3. Referral count badhao
              db.ref("users/" + referralCode + "/referralCount").transaction(count => (count || 0) + 1);

              // 4. Bonus do
              db.ref("users/" + referralCode + "/wallet").once("value").then(snapshot => {
                let wallet = snapshot.val() || { recharge: 0, bonus: 0, winning: 0, total: 0 };
                wallet.bonus += bonusAmount;
                wallet.total += bonusAmount;
                db.ref("users/" + referralCode + "/wallet").set(wallet);
              });
            }

            successAnimation.classList.add("show");
            setTimeout(() => {
              window.location.href = "index.html";
            }, 2000);
          });
        })
        .catch((error) => {
          alert("❌ " + error.message);
        });
    }
  </script>
</body>
</html>
